<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#cb4b16">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="QuiCuit">
    <title>QuiCuit ?</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* --- Reset et Variables V2 --- */
        :root {
            color-scheme: light;
            --background-color: #fdf6e3;
            --text-color: #58402c;
            --muted-text-color: rgba(88, 64, 44, 0.75);
            --title-color: #d95f43;
            --primary-color: #cb4b16;
            --primary-hover-color: #b54013;
            --card-background: #fffbee;
            --card-elevated-background: #ffffff;
            --secondary-color: #f5e5c7;
            --border-color: #e0d5b6;
            --box-shadow: 0 4px 12px rgba(88, 64, 44, 0.1);
            --box-shadow-hover: 0 6px 16px rgba(88, 64, 44, 0.15);
            --neon-text-shadow: 0 0 8px rgba(217, 95, 67, 0.5);
            --neon-button-shadow: 0 0 14px rgba(203, 75, 22, 0.4);
            --toggle-bg: rgba(255, 255, 255, 0.85);
            --toggle-border: rgba(88, 64, 44, 0.2);

            --healthy-color: #7d9a5b;
            --normal-color: #b58900;
            --fat-color: #cb4b16;
            --cold-color: #3a6ea5;
            --hot-color: #e07a5f;
        }

        :root.dark {
            color-scheme: dark;
            --background-color: #14110c;
            --text-color: #f7ede0;
            --muted-text-color: rgba(247, 237, 224, 0.75);
            --title-color: #ffb088;
            --primary-color: #ff824f;
            --primary-hover-color: #ff996d;
            --card-background: #1b160f;
            --card-elevated-background: #241d15;
            --secondary-color: #2f271c;
            --border-color: rgba(255, 255, 255, 0.22);
            --box-shadow: 0 8px 20px rgba(0, 0, 0, 0.45);
            --box-shadow-hover: 0 10px 25px rgba(0, 0, 0, 0.55);
            --neon-text-shadow: 0 0 10px rgba(255, 143, 92, 0.8), 0 0 20px rgba(255, 111, 53, 0.6);
            --neon-button-shadow: 0 0 18px rgba(255, 111, 53, 0.65);
            --toggle-bg: rgba(255, 255, 255, 0.1);
            --toggle-border: rgba(255, 255, 255, 0.3);
            --healthy-color: #94c973;
            --normal-color: #dca915;
            --fat-color: #ff824f;
            --cold-color: #4d88c9;
            --hot-color: #ff8262;
        }

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Nunito', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            display: flex;
            justify-content: center;
            padding: 1rem;
            transition: background-color 0.3s;
            position: relative;
            min-height: 100vh;
        }

        /* Monochrome fallback splash background for standalone/iOS */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background: var(--background-color);
            z-index: -1;
        }

        @media (display-mode: standalone) {
            body::before {
                background: var(--background-color);
            }
        }

        /* --- Structure principale V2 --- */
        main {
            width: 100%;
            max-width: 600px;
            display: flex;
            flex-direction: column;
            gap: 2.5rem;
        }

        section {
            background-color: var(--card-background);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: var(--box-shadow);
            border: 1px solid var(--border-color);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        h1, h2 {
            text-align: center;
            margin-bottom: 1.5rem;
            font-weight: 800;
        }

        h1 {
            font-size: 3rem;
            color: var(--title-color);
            text-shadow: var(--neon-text-shadow);
        }

        h2 {
            font-size: 1.75rem;
            color: var(--text-color);
        }
        
        /* --- Section 1: Qui cuisine ? V2 --- */
        #qui-cuisine .cook-highlight {
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            padding: 1.2rem;
            background-color: var(--secondary-color);
            border-radius: 12px;
            margin-bottom: 2rem;
            color: var(--primary-color);
        }

        .cook-pill {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            background-color: var(--card-elevated-background);
            border: 1px solid var(--border-color);
            border-radius: 999px;
            padding: 0.35rem 1rem;
            box-shadow: var(--box-shadow);
            font-size: 1.1rem;
            color: var(--text-color);
        }

        .cook-pill .cook-emoji {
            font-size: 1.3rem;
        }
        
        #weekly-view {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.75rem;
        }

        .day-card {
            position: relative;
            background: var(--card-elevated-background);
            border: 2px solid var(--secondary-color);
            border-radius: 12px;
            padding: 0.75rem;
            width: calc(33.333% - 1rem);
            min-width: 100px;
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .day-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--box-shadow);
        }
        
        .day-card .day-name {
            font-weight: 700;
            display: block;
            margin-bottom: 0.25rem;
        }
        
        .day-card .cook-name {
            font-size: 0.9rem;
            color: var(--muted-text-color);
        }

        .day-card .cook-name .cook-emoji {
            margin-right: 0.2rem;
        }

        .day-card.current-day {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: #fff;
            transform: scale(1.05);
            box-shadow: var(--box-shadow-hover);
        }
        
        .day-card.current-day .cook-name {
            color: #fff;
        }
        
        .day-card.current-day::after {
            content: 'Aujourd‚Äôhui';
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--title-color);
            color: #fff;
            padding: 3px 10px;
            font-size: 0.7rem;
            font-weight: 700;
            border-radius: 20px;
            white-space: nowrap;
        }

        /* --- Section 2: Quoi cuisiner ? V2 --- */
        #filters {
            display: flex;
            flex-direction: column;
            gap: 1.25rem;
            margin-bottom: 1.75rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-group-title {
            font-size: 0.95rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--title-color);
        }

        .filter-group-buttons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .filter-btn {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 700;
            border-radius: 50px;
            border: 2px solid var(--secondary-color);
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            background-color: var(--card-elevated-background);
            color: var(--text-color);
        }
        
        .filter-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--box-shadow);
        }

        .filter-btn.active {
            color: #fff;
            transform: translateY(-2px);
        }
        
        .filter-btn[data-category="healthy"].active {
            background-color: var(--healthy-color);
            border-color: var(--healthy-color);
        }
        .filter-btn[data-category="banale"].active {
            background-color: var(--normal-color);
            border-color: var(--normal-color);
        }
        .filter-btn[data-category="sale"].active {
            background-color: var(--fat-color);
            border-color: var(--fat-color);
        }

        .filter-btn[data-temperature="cold"].active {
            background-color: var(--cold-color);
            border-color: var(--cold-color);
        }

        .filter-btn[data-temperature="hot"].active {
            background-color: var(--hot-color);
            border-color: var(--hot-color);
        }

        #draw-button {
            display: block;
            width: 100%;
            max-width: 420px;
            margin: 1rem auto 0;
            padding: 1.2rem 2rem;
            font-size: 1.3rem;
            font-weight: 800;
            border-radius: 26px;
            border: 3px solid rgba(255, 255, 255, 0.4);
            cursor: pointer;
            background: linear-gradient(135deg, var(--primary-color), #d95026);
            color: #fff;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
            box-shadow: var(--neon-button-shadow);
            letter-spacing: 0.02em;
        }

        #draw-button:hover {
            background: linear-gradient(135deg, var(--primary-hover-color), #a93a0d);
            transform: translateY(-4px) scale(1.01);
            box-shadow: 0 18px 30px rgba(88, 64, 44, 0.25);
        }

        #draw-button:active {
            transform: translateY(-1px);
            box-shadow: var(--box-shadow);
        }

        #draw-button:focus-visible {
            outline: 3px solid rgba(255, 255, 255, 0.7);
            outline-offset: 4px;
        }

        .theme-toggle {
            margin-top: 1.5rem;
            display: flex;
            justify-content: center;
        }

        #theme-toggle {
            border: 2px solid var(--toggle-border);
            background: var(--toggle-bg);
            color: var(--text-color);
            border-radius: 999px;
            padding: 0.6rem 1.4rem;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            box-shadow: var(--box-shadow);
            transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
        }

        #theme-toggle:hover {
            transform: translateY(-2px);
            box-shadow: var(--box-shadow-hover);
        }

        :root.dark #theme-toggle {
            box-shadow: var(--neon-button-shadow);
        }

        @media (min-width: 768px) {
            #draw-button {
                font-size: 1.35rem;
                padding: 1.35rem 2.5rem;
            }
        }

        #result-container {
            display: none; /* Cach√© par d√©faut */
            margin-top: 2rem;
            text-align: center;
        }

        #result-display {
            font-size: 1.75rem;
            font-weight: 800;
            padding: 2rem;
            background: var(--title-color);
            color: #fff;
            border-radius: 16px;
            animation: fadeIn 0.5s ease-out;
            box-shadow: var(--box-shadow);
        }

        .result-actions {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
            margin-top: 1.4rem;
        }

        @media (min-width: 480px) {
            .result-actions {
                flex-direction: row;
                justify-content: center;
            }
        }

        /* --- Section 3: Catalogue de recettes --- */
        #recettes-disponibles .recipes-grid {
            display: grid;
            gap: 1.25rem;
            align-items: start;
        }

        @media (min-width: 600px) {
            #recettes-disponibles .recipes-grid {
                grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            }
        }

        .recipe-category {
            background-color: var(--card-elevated-background);
            border-radius: 14px;
            padding: 1rem 1.25rem;
            border: 1px solid var(--border-color);
            box-shadow: var(--box-shadow);
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .recipe-category .category-toggle {
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
            text-align: left;
            font-weight: 700;
            font-family: inherit;
            color: inherit;
        }

        .recipe-category .chevron {
            transition: transform 0.2s ease;
            font-size: 1.2rem;
        }

        .recipe-category.collapsed .chevron {
            transform: rotate(-90deg);
        }

        .recipe-category.collapsed .recipe-list {
            display: none;
        }

        .recipe-category ul {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
            font-size: 0.95rem;
        }

        .recipe-category li {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 0.35rem;
        }

        .recipe-category .dish-name {
            font-weight: 600;
        }

        .temperature-tag {
            margin-left: 0.35rem;
            padding: 0.1rem 0.45rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 700;
            color: #fff;
            display: inline-flex;
            align-items: center;
            white-space: nowrap;
        }

        .temperature-tag.cold {
            background-color: var(--cold-color);
        }

        .temperature-tag.hot {
            background-color: var(--hot-color);
        }

        .recipe-category.healthy .category-toggle {
            color: var(--healthy-color);
        }

        .recipe-category.banale .category-toggle {
            color: var(--normal-color);
        }

        .recipe-category.sale .category-toggle {
            color: var(--fat-color);
        }

        /* --- Section 3: Recette ChatGPT V2 --- */
        .result-link {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            padding: 0.85rem 1.75rem;
            font-size: 1rem;
            font-weight: 700;
            border-radius: 50px;
            text-decoration: none;
            color: #fff;
            transition: background-color 0.2s, transform 0.2s;
            box-shadow: var(--box-shadow);
        }

        #chatgpt-link {
            background-color: var(--healthy-color);
        }

        #chatgpt-link:hover {
            background-color: #6b844d;
            transform: translateY(-3px) scale(1.05);
            box-shadow: var(--box-shadow-hover);
        }

        #more-ideas-link {
            background-color: var(--primary-color);
        }

        #more-ideas-link:hover {
            background-color: var(--primary-hover-color);
            transform: translateY(-3px) scale(1.05);
            box-shadow: var(--box-shadow-hover);
        }

        /* --- Animations --- */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

    </style>
</head>
<body>

    <main>
        <h1>QuiCuit ?</h1>

        <!-- Section 1: Qui cuisine aujourd'hui ? -->
        <section id="qui-cuisine">
            <p id="cook-of-the-day" class="cook-highlight">Chargement...</p>
            <div id="weekly-view">
                <!-- La vue semaine sera inject√©e ici par le JS -->
            </div>
        </section>

        <!-- Section 2: Quoi cuisiner ? -->
        <section id="quoi-cuisiner">
            <h2>Quoi cuisiner ?</h2>
            
            <div id="filters">
                <div class="filter-group">
                    <p class="filter-group-title">Style de plat</p>
                    <div class="filter-group-buttons">
                        <button class="filter-btn" data-category="healthy">Healthy ü•ï</button>
                        <button class="filter-btn" data-category="banale">Banale üçö</button>
                        <button class="filter-btn" data-category="sale">Sale üçî</button>
                    </div>
                </div>

                <div class="filter-group">
                    <p class="filter-group-title">M√©t√©o</p>
                    <div class="filter-group-buttons temperature-buttons">
                        <button class="filter-btn" data-temperature="cold">Quand il fait froid ‚ùÑÔ∏è</button>
                        <button class="filter-btn" data-temperature="hot">Quand il fait chaud ‚òÄÔ∏è</button>
                    </div>
                </div>
            </div>

            <button id="draw-button">Tirer au sort un plat !</button>

            <div id="result-container">
                <div id="result-display"></div>
                <!-- Section 3: Recette ChatGPT (le lien est inject√© ici) -->
                <div class="result-actions">
                    <a id="chatgpt-link" class="result-link" href="#" target="_blank" rel="noopener noreferrer" style="display: none;">Voir la recette</a>
                    <a id="more-ideas-link" class="result-link" href="#" target="_blank" rel="noopener noreferrer" style="display: none;">D‚Äôautres id√©es ?</a>
                </div>
            </div>
        </section>

        <!-- Section 3: Recettes d√©taill√©es -->
        <section id="recettes-disponibles">
            <h2>Recettes par filtre</h2>
            <div id="recipes-by-filter" class="recipes-grid">
                <!-- Liste remplie par le JS -->
            </div>
        </section>

        <div class="theme-toggle">
            <button id="theme-toggle" type="button" aria-pressed="false">
                <span class="toggle-icon" aria-hidden="true">üåû</span>
                <span class="toggle-label">Mode clair</span>
            </button>
        </div>

    </main>

    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- Donn√©es de l'application ---

        const weeklySchedule = {
            'Lundi': 'lui',
            'Mardi': 'elle',
            'Mercredi': 'elle',
            'Jeudi': 'lui',
            'Vendredi': 'lui',
            'Samedi': 'elle',
            'Dimanche': 'lui'
        };

        const cookMood = {
            'lui': { emoji: 'üßîüèª‚Äç‚ôÇÔ∏è‚öΩÔ∏è', label: 'lui' },
            'elle': { emoji: 'üë©üèªüå∏', label: 'elle' }
        };

        const dishes = {
            healthy: [
                'Soupe lentilles corail',
                'Soupe l√©gumes',
                'Soupe lentilles coco',
                'Po√™l√©e haricots verts',
                'Po√™l√©e l√©gumes/viande',
                'Fondue de poireau',
                'Patates vapeur',
                'Soupe poulet vermicelles',
                'Ratatouille',
                'Patates sauce tomate',
                'Tian de l√©gumes',
                'Salade betterave/carottes',
                'Salade de tomates',
                'Brocolis vapeur',
                'Choux fleur vapeur',
                'Pur√©e de pois cass√©s',
                'Haricots blancs',
                'One pot riz poireaux saumon',
                'One pot lentilles corail √©pinards tomate',
                'Wok de l√©gumes et nouilles',
                'Taboul√© maison',
                'Curry de pois chiches coco',
                'Salade de patates et ≈ìufs'
            ],
            banale: [
                'Endives au jambon',
                'Poulet Yassa',
                'P√¢tes bolo',
                'P√¢tes sauce tomate',
                'Poulet curry',
                'Pav√© de saumon',
                'Omelette',
                'Tarte √† la tomate',
                'Salade de p√¢tes',
                'Salade de riz',
                'Couscous',
                'Bateau d\'aubergine',
                'Tomates farcies',
                'Bruschetta',
                'Avocado toast',
                'Galettes bretonnes',
                'Pur√©e de patates/carottes',
                'Salade de ch√®vre chaud',
                'Chili con carne',
                'Boulgour en sauce',
                'Pur√©e de pomme de terre/carottes',
                'Saut√© de poulet aux l√©gumes',
                'Saut√© de b≈ìuf aux oignons',
                'Quiche / Tarte de l√©gumes',
                'Chakchouka'
            ],
            sale: [
                'Panier jambon',
                'Risotto chorizo',
                'Hamburger maison',
                'Pizza maison',
                'P√¢tes carbo',
                'Lasagnes',
                'Quiche lorraine',
                'Raclette',
                'Tartiflette',
                'Steak frites',
                'Gnocchis pesto vert',
                'Gratin dauphinois',
                'Boeuf bourguignon',
                'Croque monsieur',
                'Poulet r√¥ti patates',
                'Fish & Chips',
                'Tacos mexicain maison',
                'Blanquette de veau'
            ]
        };

        const categoriesMeta = {
            healthy: { label: 'Healthy ü•ï', prompt: 'd‚Äôesprit healthy' },
            banale: { label: 'Banale üçö', prompt: 'de tous les jours' },
            sale: { label: 'Sale üçî', prompt: 'bien gourmand' }
        };

        const temperatureLabels = {
            cold: 'Froid ‚ùÑÔ∏è',
            hot: 'Chaud ‚òÄÔ∏è'
        };

        const temperaturePromptLabels = {
            cold: 'quand il fait froid',
            hot: 'quand il fait chaud'
        };

        const dishTemperatureTags = {
            'Soupe lentilles corail': ['cold'],
            'Soupe l√©gumes': ['cold'],
            'Soupe lentilles coco': ['cold'],
            'Soupe poulet vermicelles': ['cold'],
            'Fondue de poireau': ['cold'],
            'Raclette': ['cold'],
            'Tartiflette': ['cold'],
            'Gratin dauphinois': ['cold'],
            'Boeuf bourguignon': ['cold'],
            'Chili con carne': ['cold'],
            'Pur√©e de pois cass√©s': ['cold'],
            'Haricots blancs': ['cold'],
            'One pot riz poireaux saumon': ['cold'],
            'One pot lentilles corail √©pinards tomate': ['cold'],
            'Risotto chorizo': ['cold'],
            'Salade de p√¢tes': ['hot'],
            'Salade de riz': ['hot'],
            'Salade betterave/carottes': ['hot'],
            'Salade de tomates': ['hot'],
            'Salade de ch√®vre chaud': ['hot'],
            'Bruschetta': ['hot'],
            'Avocado toast': ['hot'],
            'Tian de l√©gumes': ['hot'],
            'Pizza maison': [],
            'Saut√© de poulet aux l√©gumes': ['cold'],
            'Saut√© de b≈ìuf aux oignons': ['cold'],
            'Blanquette de veau': ['cold'],
            'Taboul√© maison': ['hot'],
            'Salade de patates et ≈ìufs': ['hot']
        };

        // --- √âl√©ments du DOM ---
        
        const cookDisplay = document.getElementById('cook-of-the-day');
        const weeklyViewContainer = document.getElementById('weekly-view');
        const categoryButtons = document.querySelectorAll('.filter-btn[data-category]');
        const temperatureButtons = document.querySelectorAll('.filter-btn[data-temperature]');
        const drawButton = document.getElementById('draw-button');
        const resultContainer = document.getElementById('result-container');
        const resultDisplay = document.getElementById('result-display');
        const chatgptLink = document.getElementById('chatgpt-link');
        const moreIdeasLink = document.getElementById('more-ideas-link');
        const themeToggleButton = document.getElementById('theme-toggle');
        const themeToggleIcon = themeToggleButton ? themeToggleButton.querySelector('.toggle-icon') : null;
        const themeToggleText = themeToggleButton ? themeToggleButton.querySelector('.toggle-label') : null;
        const recipesByFilterContainer = document.getElementById('recipes-by-filter');

        // --- Logique de l'application ---

        const THEME_STORAGE_KEY = 'quicuit-theme';
        const systemDarkQuery = window.matchMedia('(prefers-color-scheme: dark)');

        function applyTheme(theme) {
            const root = document.documentElement;
            const isDark = theme === 'dark';
            root.classList.toggle('dark', isDark);
            if (themeToggleButton) {
                themeToggleButton.setAttribute('aria-pressed', String(isDark));
                if (themeToggleIcon) {
                    themeToggleIcon.textContent = isDark ? 'üåô' : 'üåû';
                }
                if (themeToggleText) {
                    themeToggleText.textContent = isDark ? 'Mode sombre' : 'Mode clair';
                }
            }
        }

        function getPreferredTheme() {
            const stored = localStorage.getItem(THEME_STORAGE_KEY);
            if (stored === 'dark' || stored === 'light') {
                return stored;
            }
            return systemDarkQuery.matches ? 'dark' : 'light';
        }

        function getTodayDayName() {
            const dayIndex = new Date().getDay(); // 0=Dim, 1=Lun, ..., 6=Sam
            const days = ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'];
            return days[dayIndex];
        }

        /**
         * Section 1.1: Affiche qui cuisine aujourd'hui.
         */
        function setCookOfTheDay() {
            const todayName = getTodayDayName();
            const currentCook = weeklySchedule[todayName];
            const mood = cookMood[currentCook] || { emoji: 'üç≥', label: currentCook };
            const badge = `<span class="cook-pill"><span class="cook-emoji">${mood.emoji}</span><span class="cook-label">${mood.label}</span></span>`;
            cookDisplay.innerHTML = `Aujourd‚Äôhui, c‚Äôest ${badge} qui cuisine !`;
        }
        
        /**
         * Section 1.2: Affiche la vue de la semaine.
         */
        function renderWeeklyView() {
            const todayName = getTodayDayName();
            const daysOrder = ['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi', 'Dimanche'];
            
            weeklyViewContainer.innerHTML = ''; // Vide le conteneur

            daysOrder.forEach(day => {
                const cook = weeklySchedule[day];
                const mood = cookMood[cook] || {};
                const card = document.createElement('div');
                card.className = 'day-card';
                
                if (day === todayName) {
                    card.classList.add('current-day');
                }
                
                card.innerHTML = `
                    <span class="day-name">${day.substring(0, 3)}</span>
                    <span class="cook-name">${mood.emoji ? `<span class="cook-emoji">${mood.emoji}</span>` : ''}${cook}</span>
                `;
                weeklyViewContainer.appendChild(card);
            });
        }

        /**
         * Section 2 bis: Affiche les recettes disponibles pour chaque filtre.
         */
        function renderRecipesByFilter() {
            if (!recipesByFilterContainer) return;

            recipesByFilterContainer.innerHTML = '';

            Object.keys(categoriesMeta).forEach(category => {
                const card = document.createElement('div');
                card.className = `recipe-category ${category}`;

                const listItems = (dishes[category] || [])
                    .map(dish => {
                        const tags = (dishTemperatureTags[dish] || [])
                            .map(temp => `<span class="temperature-tag ${temp}">${temperatureLabels[temp]}</span>`)
                            .join('');
                        return `<li><span class="dish-name">${dish}</span>${tags}</li>`;
                    })
                    .join('');

                card.innerHTML = `
                    <button class="category-toggle" type="button" aria-expanded="false">
                        <span>${categoriesMeta[category].label}</span>
                        <span class="chevron">‚åÑ</span>
                    </button>
                    <ul class="recipe-list">${listItems}</ul>
                `;

                const toggleButton = card.querySelector('.category-toggle');
                const recipeList = card.querySelector('.recipe-list');

                card.classList.add('collapsed');

                toggleButton.addEventListener('click', () => {
                    const isCollapsed = card.classList.toggle('collapsed');
                    toggleButton.setAttribute('aria-expanded', String(!isCollapsed));
                });

                recipesByFilterContainer.appendChild(card);
            });
        }

        function setupCategoryFilters() {
            categoryButtons.forEach(button => {
                button.addEventListener('click', () => {
                    button.classList.toggle('active');
                });
            });
        }

        function getDefaultTemperatureFilter() {
            const month = new Date().getMonth(); // 0=Janvier
            return month >= 4 && month <= 8 ? 'hot' : 'cold';
        }

        function setupTemperatureFilters() {
            const defaultTemp = getDefaultTemperatureFilter();
            const defaultButton = Array.from(temperatureButtons).find(
                button => button.dataset.temperature === defaultTemp
            );
            if (defaultButton) {
                defaultButton.classList.add('active');
            }

            temperatureButtons.forEach(button => {
                button.addEventListener('click', () => {
                    button.classList.toggle('active');
                });
            });
        }

        function getSelectedCategories() {
            return Array.from(categoryButtons)
                .filter(btn => btn.classList.contains('active'))
                .map(btn => btn.dataset.category);
        }

        function getSelectedTemperatures() {
            return Array.from(temperatureButtons)
                .filter(btn => btn.classList.contains('active'))
                .map(btn => btn.dataset.temperature);
        }

        function matchesTemperature(dishName, activeTemperatures) {
            if (activeTemperatures.length === 0) return true;
            const tags = dishTemperatureTags[dishName];
            if (!tags) return true;
            return activeTemperatures.some(temp => tags.includes(temp));
        }

        function describeFilters(categories, temperatures) {
            const stylePart = categories.length > 0
                ? categories.map(cat => categoriesMeta[cat]?.prompt || cat).join(', ')
                : 'n‚Äôimporte quel style';

            const weatherPart = temperatures.length > 0
                ? temperatures.map(temp => temperaturePromptLabels[temp] || temp).join(', ')
                : 'toutes les m√©t√©os';

            return { stylePart, weatherPart };
        }

        function setupThemeToggle() {
            applyTheme(getPreferredTheme());

            if (themeToggleButton) {
                themeToggleButton.addEventListener('click', () => {
                    const isDark = document.documentElement.classList.contains('dark');
                    const nextTheme = isDark ? 'light' : 'dark';
                    localStorage.setItem(THEME_STORAGE_KEY, nextTheme);
                    applyTheme(nextTheme);
                });
            }

            const handleSystemChange = event => {
                const stored = localStorage.getItem(THEME_STORAGE_KEY);
                if (stored === 'dark' || stored === 'light') {
                    return;
                }
                applyTheme(event.matches ? 'dark' : 'light');
            };

            if (typeof systemDarkQuery.addEventListener === 'function') {
                systemDarkQuery.addEventListener('change', handleSystemChange);
            } else if (typeof systemDarkQuery.addListener === 'function') {
                systemDarkQuery.addListener(handleSystemChange);
            }
        }

        /**
         * Section 2 & 3: G√®re la roulette de plats.
         */
        function setupRoulette() {
            drawButton.addEventListener('click', () => {
                const activeCategories = getSelectedCategories();
                const activeTemperatures = getSelectedTemperatures();

                let pool = [];

                if (activeCategories.length === 0) {
                    pool = Object.values(dishes).flat();
                } else {
                    activeCategories.forEach(category => {
                        pool.push(...dishes[category]);
                    });
                }

                pool = pool.filter(dish => matchesTemperature(dish, activeTemperatures));
                
                if (pool.length > 0) {
                    const randomIndex = Math.floor(Math.random() * pool.length);
                    displayResult(pool[randomIndex], activeCategories, activeTemperatures);
                }
            });
        }
        
        /**
         * Affiche le plat s√©lectionn√© et le lien vers la recette.
         * @param {string} dishName - Le nom du plat √† afficher.
         */
        function buildChatGptUrl(prompt) {
            const baseUrl = 'https://chat.openai.com/';
            return `${baseUrl}?q=${encodeURIComponent(prompt)}`;
        }

        function displayResult(dishName, categories = [], temperatures = []) {
            resultDisplay.textContent = dishName;
            
            const filterDescription = describeFilters(categories, temperatures);
            const recipePrompt = `Tu es un chef moderne. Donne-moi une recette simple, rapide et d√©taill√©e pour pr√©parer "${dishName}". Le style recherch√© est ${filterDescription.stylePart} et la m√©t√©o correspond √† ${filterDescription.weatherPart}. R√©ponds avec ingr√©dients, √©tapes, temps total et id√©es healthy.`;
            const moreIdeasPrompt = `Sugg√®re 5 autres recettes faciles et rapides (${filterDescription.stylePart}, m√©t√©o : ${filterDescription.weatherPart}). Pour chaque proposition : nom, temps approximatif, pourquoi c‚Äôest adapt√©.`;

            chatgptLink.href = buildChatGptUrl(recipePrompt);
            moreIdeasLink.href = buildChatGptUrl(moreIdeasPrompt);

            resultContainer.style.display = 'block';
            chatgptLink.style.display = 'inline-flex';
            moreIdeasLink.style.display = 'inline-flex';
        }

        // --- Initialisation ---
        setCookOfTheDay();
        renderWeeklyView();
        renderRecipesByFilter();
        setupCategoryFilters();
        setupTemperatureFilters();
        setupRoulette();
        setupThemeToggle();

    });
    </script>
    <script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./service-worker.js')
                .catch((error) => console.error('Service worker registration failed:', error));
        });
    }
    </script>
</body>
</html>
